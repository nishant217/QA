import { create } from 'zustand';
import { persist } from 'zustand/middleware';
import type { Transaction } from '@/types';

interface TransactionState {
  transactions: Transaction[];
  addTransaction: (transaction: Omit<Transaction, 'id' | 'createdAt'>) => void;
  updateTransaction: (id: string, updates: Partial<Transaction>) => void;
  getTransactionsByFD: (fdId: string) => Transaction[];
  getTransactionsByStatus: (status: Transaction['status']) => Transaction[];
  getRecentTransactions: (count: number) => Transaction[];
}

const SEED_TRANSACTIONS: Transaction[] = [
  {
    id: 'txn-001',
    referenceNumber: 'TXN-2026-000001',
    type: 'Deposit',
    amount: 20000000,
    currency: 'INR',
    description: 'FD booking - HDFC Bank',
    status: 'Completed',
    relatedFDId: 'fd-001',
    bankAccount: '50100234567890',
    createdAt: '2026-01-15T10:30:00Z',
    createdBy: 'demo-001',
  },
  {
    id: 'txn-002',
    referenceNumber: 'TXN-2026-000002',
    type: 'Deposit',
    amount: 5000000,
    currency: 'INR',
    description: 'FD booking - SBI',
    status: 'Completed',
    relatedFDId: 'fd-002',
    bankAccount: '345678901234',
    createdAt: '2026-01-10T09:15:00Z',
    createdBy: 'demo-001',
  },
  {
    id: 'txn-003',
    referenceNumber: 'TXN-2026-000003',
    type: 'Deposit',
    amount: 15000000,
    currency: 'INR',
    description: 'FD booking - ICICI Bank',
    status: 'Completed',
    relatedFDId: 'fd-003',
    bankAccount: '123456789012',
    createdAt: '2026-02-01T14:20:00Z',
    createdBy: 'demo-001',
  },
  {
    id: 'txn-004',
    referenceNumber: 'TXN-2026-000004',
    type: 'Transfer',
    amount: 30000000,
    currency: 'INR',
    description: 'FD booking - Kotak Mahindra Bank',
    status: 'Completed',
    relatedFDId: 'fd-005',
    bankAccount: '515253545556',
    createdAt: '2026-01-05T10:00:00Z',
    createdBy: 'demo-001',
  },
  {
    id: 'txn-005',
    referenceNumber: 'TXN-2026-000005',
    type: 'Deposit',
    amount: 10000000,
    currency: 'INR',
    description: 'FD booking - IDFC First Bank',
    status: 'Completed',
    relatedFDId: 'fd-006',
    bankAccount: '616263646566',
    createdAt: '2026-01-20T09:30:00Z',
    createdBy: 'demo-001',
  },
  {
    id: 'txn-006',
    referenceNumber: 'TXN-2026-000006',
    type: 'Withdrawal',
    amount: 25000000,
    currency: 'INR',
    description: 'FD maturity payout - SBI FD-2026-008',
    status: 'Pending',
    relatedFDId: 'fd-008',
    bankAccount: '345678901235',
    createdAt: '2026-02-15T09:00:00Z',
    createdBy: 'demo-001',
  },
  {
    id: 'txn-007',
    referenceNumber: 'TXN-2026-000007',
    type: 'Payment',
    amount: 375000,
    currency: 'INR',
    description: 'Quarterly interest payment - HDFC FD-2026-001',
    status: 'Completed',
    relatedFDId: 'fd-001',
    bankAccount: '50100234567890',
    createdAt: '2026-04-15T10:00:00Z',
    createdBy: 'system',
  },
  {
    id: 'txn-008',
    referenceNumber: 'TXN-2026-000008',
    type: 'Refund',
    amount: 50000,
    currency: 'INR',
    description: 'Excess TDS refund from HDFC Bank',
    status: 'Completed',
    bankAccount: '50100234567890',
    createdAt: '2026-02-10T11:30:00Z',
    createdBy: 'system',
  },
  {
    id: 'txn-009',
    referenceNumber: 'TXN-2026-000009',
    type: 'Deposit',
    amount: 50000000,
    currency: 'INR',
    description: 'FD booking - HDFC Bank',
    status: 'Completed',
    relatedFDId: 'fd-007',
    bankAccount: '50100234567891',
    createdAt: '2026-02-10T13:45:00Z',
    createdBy: 'demo-001',
  },
  {
    id: 'txn-010',
    referenceNumber: 'TXN-2026-000010',
    type: 'Deposit',
    amount: 10000000,
    currency: 'INR',
    description: 'FD booking - Yes Bank',
    status: 'Completed',
    relatedFDId: 'fd-009',
    bankAccount: '717273747576',
    createdAt: '2026-01-25T11:30:00Z',
    createdBy: 'demo-001',
  },
  {
    id: 'txn-011',
    referenceNumber: 'TXN-2026-000011',
    type: 'Deposit',
    amount: 8000000,
    currency: 'INR',
    description: 'FD booking - IndusInd Bank',
    status: 'Completed',
    relatedFDId: 'fd-010',
    bankAccount: '818283848586',
    createdAt: '2026-02-05T09:00:00Z',
    createdBy: 'demo-001',
  },
  {
    id: 'txn-012',
    referenceNumber: 'TXN-2026-000012',
    type: 'Deposit',
    amount: 40000000,
    currency: 'INR',
    description: 'FD booking - ICICI Bank',
    status: 'Completed',
    relatedFDId: 'fd-011',
    bankAccount: '123456789013',
    createdAt: '2026-02-15T14:00:00Z',
    createdBy: 'demo-001',
  },
  {
    id: 'txn-013',
    referenceNumber: 'TXN-2026-000013',
    type: 'Deposit',
    amount: 12500000,
    currency: 'INR',
    description: 'FD booking - Axis Bank',
    status: 'Completed',
    relatedFDId: 'fd-012',
    bankAccount: '910111213142',
    createdAt: '2025-02-25T10:30:00Z',
    createdBy: 'admin-001',
  },
  {
    id: 'txn-014',
    referenceNumber: 'TXN-2026-000014',
    type: 'Deposit',
    amount: 6000000,
    currency: 'INR',
    description: 'FD booking - Kotak Mahindra Bank',
    status: 'Completed',
    relatedFDId: 'fd-013',
    bankAccount: '515253545557',
    createdAt: '2026-01-12T11:00:00Z',
    createdBy: 'demo-001',
  },
  {
    id: 'txn-015',
    referenceNumber: 'TXN-2026-000015',
    type: 'Deposit',
    amount: 35000000,
    currency: 'INR',
    description: 'FD booking - HDFC Bank',
    status: 'Completed',
    relatedFDId: 'fd-014',
    bankAccount: '50100234567892',
    createdAt: '2026-02-08T09:45:00Z',
    createdBy: 'demo-001',
  },
  {
    id: 'txn-016',
    referenceNumber: 'TXN-2026-000016',
    type: 'Deposit',
    amount: 17500000,
    currency: 'INR',
    description: 'FD booking - IDFC First Bank',
    status: 'Completed',
    relatedFDId: 'fd-015',
    bankAccount: '616263646567',
    createdAt: '2026-02-18T13:00:00Z',
    createdBy: 'demo-001',
  },
  {
    id: 'txn-017',
    referenceNumber: 'TXN-2026-000017',
    type: 'Payment',
    amount: 750000,
    currency: 'INR',
    description: 'Interest payment - Axis Bank FD-2026-004',
    status: 'Completed',
    relatedFDId: 'fd-004',
    bankAccount: '910111213141',
    createdAt: '2025-05-20T10:00:00Z',
    createdBy: 'system',
  },
  {
    id: 'txn-018',
    referenceNumber: 'TXN-2026-000018',
    type: 'Payment',
    amount: 1250000,
    currency: 'INR',
    description: 'Interest payment - Axis Bank FD-2026-004',
    status: 'Completed',
    relatedFDId: 'fd-004',
    bankAccount: '910111213141',
    createdAt: '2025-08-20T10:00:00Z',
    createdBy: 'system',
  },
  {
    id: 'txn-019',
    referenceNumber: 'TXN-2026-000019',
    type: 'Payment',
    amount: 1250000,
    currency: 'INR',
    description: 'Interest payment - Axis Bank FD-2026-004',
    status: 'Completed',
    relatedFDId: 'fd-004',
    bankAccount: '910111213141',
    createdAt: '2025-11-20T10:00:00Z',
    createdBy: 'system',
  },
  {
    id: 'txn-020',
    referenceNumber: 'TXN-2026-000020',
    type: 'Payment',
    amount: 1250000,
    currency: 'INR',
    description: 'Interest payment - Axis Bank FD-2026-012',
    status: 'Completed',
    relatedFDId: 'fd-012',
    bankAccount: '910111213142',
    createdAt: '2025-05-25T10:00:00Z',
    createdBy: 'system',
  },
  {
    id: 'txn-021',
    referenceNumber: 'TXN-2026-000021',
    type: 'Payment',
    amount: 1250000,
    currency: 'INR',
    description: 'Interest payment - Axis Bank FD-2026-012',
    status: 'Completed',
    relatedFDId: 'fd-012',
    bankAccount: '910111213142',
    createdAt: '2025-08-25T10:00:00Z',
    createdBy: 'system',
  },
  {
    id: 'txn-022',
    referenceNumber: 'TXN-2026-000022',
    type: 'Payment',
    amount: 1250000,
    currency: 'INR',
    description: 'Interest payment - Axis Bank FD-2026-012',
    status: 'Completed',
    relatedFDId: 'fd-012',
    bankAccount: '910111213142',
    createdAt: '2025-11-25T10:00:00Z',
    createdBy: 'system',
  },
  {
    id: 'txn-023',
    referenceNumber: 'TXN-2026-000023',
    type: 'Transfer',
    amount: 5000000,
    currency: 'INR',
    description: 'Internal transfer between accounts',
    status: 'Completed',
    createdAt: '2026-02-01T09:00:00Z',
    createdBy: 'demo-001',
  },
  {
    id: 'txn-024',
    referenceNumber: 'TXN-2026-000024',
    type: 'Payment',
    amount: 25000,
    currency: 'INR',
    description: 'Bank charges - annual fee',
    status: 'Completed',
    createdAt: '2026-01-01T00:00:00Z',
    createdBy: 'system',
  },
  {
    id: 'txn-025',
    referenceNumber: 'TXN-2026-000025',
    type: 'Deposit',
    amount: 7500000,
    currency: 'INR',
    description: 'FD booking - Axis Bank',
    status: 'Completed',
    relatedFDId: 'fd-004',
    bankAccount: '910111213141',
    createdAt: '2025-02-20T11:00:00Z',
    createdBy: 'admin-001',
  },
];

export const useTransactionStore = create<TransactionState>()(
  persist(
    (set, get) => ({
      transactions: SEED_TRANSACTIONS,

      addTransaction: (transaction) => {
        const newTransaction: Transaction = {
          ...transaction,
          id: `txn-${Date.now()}`,
          createdAt: new Date().toISOString(),
        };
        set((state) => ({
          transactions: [newTransaction, ...state.transactions],
        }));
      },

      updateTransaction: (id, updates) => {
        set((state) => ({
          transactions: state.transactions.map(t =>
            t.id === id ? { ...t, ...updates } : t
          ),
        }));
      },

      getTransactionsByFD: (fdId) => {
        return get().transactions.filter(t => t.relatedFDId === fdId);
      },

      getTransactionsByStatus: (status) => {
        return get().transactions.filter(t => t.status === status);
      },

      getRecentTransactions: (count) => {
        return get().transactions
          .sort((a, b) => new Date(b.createdAt).getTime() - new Date(a.createdAt).getTime())
          .slice(0, count);
      },
    }),
    {
      name: 'nyneos-transactions',
    }
  )
);
